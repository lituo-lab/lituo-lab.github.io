---
title: 自抗扰控制（ADRC）与扩张状态观测器（ESO）
date: 2025-05-16
categories: [控制理论, 鲁棒控制]
tags: [ADRC, ESO, 极点配置, 滤波, 跟踪微分器]
math: true
---

## 一、ADRC与ESO基础原理

### 1.1 ADRC简介

- ADRC是一种不依赖精确模型、能够主动估计和补偿系统扰动的现代控制方法。
- 主要核心模块包括：跟踪微分器（TD）、扩张状态观测器（ESO）、非线性误差反馈（NLSEF）。

### 1.2 ESO基本结构与原理

以一阶系统为例，系统动力学如下：

$$
\dot{v} = u + d
$$

ESO扩展状态定义：
- $\hat{x}_1$：估计速度
- $\hat{x}_2$：估计总扰动

ESO更新公式（二阶）：

$$
\begin{cases}
\dot{\hat{x}}_1 = u + \hat{x}_2 + \beta_1 (v - \hat{x}_1) \\
\dot{\hat{x}}_2 = \beta_2 (v - \hat{x}_1)
\end{cases}
$$

> **Note**: ESO通过测量值和模型不断修正自身对速度和扰动的猜测，最终让控制器能更精准地补偿扰动。

### 1.3 ESO稳定性分析

定义估计误差。由于 $\hat{x}_1$ 是速度 $v$ 的估计值，$\hat{x}_2$ 是总扰动 $d$ 的估计值，因此误差自然定义为估计值与真实值之差：

$$
\begin{align*}
e_1 &= v - \hat{x}_1 \\
e_2 &= d - \hat{x}_2
\end{align*}
$$

对 $e_1$ 求导并代入系统动力学 $\dot{v} = u + d$ 和ESO动态方程 $\dot{\hat{x}}_1 = u + \hat{x}_2 + \beta_1 (v - \hat{x}_1)$：

$$
\begin{align*}
\dot{e}_1 &= \dot{v} - \dot{\hat{x}}_1 \\
&= (u + d) - [u + \hat{x}_2 + \beta_1 (v - \hat{x}_1)] \\
&= d - \hat{x}_2 - \beta_1 e_1 \\
&= e_2 - \beta_1 e_1
\end{align*}
$$

对 $e_2$ 求导。假设扰动变化缓慢，即 $\dot{d} \approx 0$，并代入ESO动态方程 $\dot{\hat{x}}_2 = \beta_2 (v - \hat{x}_1)$：

$$
\begin{align*}
\dot{e}_2 &= \dot{d} - \dot{\hat{x}}_2 \\
&\approx 0 - \beta_2 (v - \hat{x}_1) \\
&= -\beta_2 e_1
\end{align*}
$$

因此，误差动力学系统为：

$$
\begin{bmatrix}
\dot{e}_1 \\
\dot{e}_2
\end{bmatrix} =
\begin{bmatrix}
-\beta_1 & 1 \\
-\beta_2 & 0
\end{bmatrix}
\begin{bmatrix}
e_1 \\
e_2
\end{bmatrix}
$$

特征方程为：

$$
\det\left( s\mathbf{I} - \begin{bmatrix} -\beta_1 & 1 \\ -\beta_2 & 0 \end{bmatrix} \right) = s^2 + \beta_1 s + \beta_2 = 0
$$

稳定性条件（特征根均具有负实部）：

$$
\beta_1 > 0, \quad \beta_2 > 0
$$

只要满足上述条件，ESO误差系统全局渐近稳定，估计误差指数收敛到零。

---

## 二、ESO参数设计与极点配置法

### 2.1 极点配置法原理

- 通过极点配置法确定ESO参数，使误差系统收敛速度与带宽可控。
- 二阶ESO参数配置如下：

$$
\beta_1 = 2\omega_o, \quad
\beta_2 = \omega_o^2
$$

其中，$\omega_o$为ESO带宽（一般选为主系统带宽的3~10倍）。

### 2.2 带宽参数化与极点配置

带宽参数化是一种特殊的极点配置方法，将ESO误差系统的极点配置在 $-\omega_o$ 处。

期望特征方程：

$$
(s + \omega_o)^2 = s^2 + 2\omega_o s + \omega_o^2 = 0
$$

实际系统特征方程：

$$
s^2 + \beta_1 s + \beta_2 = 0
$$

令两式相等，解得：

$$
\beta_1 = 2\omega_o, \quad \beta_2 = \omega_o^2
$$

工程中常采用更激进的参数配置：

$$
\beta_1 = 3\omega_o, \quad \beta_2 = \omega_o^2
$$

这种"三倍"关系源于另一种参数化方法，旨在提供更快的收敛速度。只要保证 $\beta_1 > 0, \beta_2 > 0$，系统就是稳定的。

### 2.3 工程实践考虑

- $\omega_o$ 越大，观测器带宽越高，估计收敛越快，但对噪声更加敏感
- 实际工程需权衡收敛速度与抗噪声能力
- 推荐 $\omega_o$ 选为主系统带宽的3~10倍

> **Note**: 参数选取不宜一味求快，需结合系统噪声实际进行调试。只要观测器带宽 $\omega_o > 0$，参数 $\beta_1 = 3\omega_o$ 和 $\beta_2 = \omega_o^2$ 就能保证误差动力学系统全局渐近稳定。

---

## 三、ESO扰动估计与传递函数推导

### 3.1 代码实现（速度观测下ESO扰动估计）

```matlab
omega_o = 20;
beta1 = 3 * omega_o;
beta2 = omega_o^2;

x1 = 0; % ESO速度估计
x2 = 0; % ESO扰动估计

for i = 1:steps
    e1 = v(i) - x1;
    x1 = x1 + dt * (u(i) + x2 + beta1 * e1);
    x2 = x2 + dt * (beta2 * e1);
    d_est(i) = x2;
end
```

### 3.2 传递函数推导

ESO的连续时间结构为：

$$
\begin{cases}
\dot{x}_1 = u + x_2 + \beta_1 (v - x_1) \\
\dot{x}_2 = \beta_2 (v - x_1)
\end{cases}
$$

对上述方程进行拉氏变换（零初始条件），得到：

$$
\begin{cases}
sX_1(s) = U(s) + X_2(s) + \beta_1 [V(s) - X_1(s)] \\
sX_2(s) = \beta_2 [V(s) - X_1(s)]
\end{cases}
$$

扰动估计 $d_{est}(s)$ 与控制量 $u(s)$、速度观测 $v(s)$ 的传递函数关系为：

$$
d_{est}(s) = X_2(s) = \frac{\beta_2}{s^2 + \beta_1 s + \beta_2} \left[ s V(s) - U(s) \right]
$$

- $U(s)$：控制输入的拉氏变换
- $V(s)$：速度观测的拉氏变换
- $sV(s)$：速度的导数（即加速度的拉氏变换）
- $\beta_1, \beta_2$：ESO参数

> **Note**: ESO扰动估计本质上是对"加速度（速度一阶导）与控制量之差"进行二阶滤波处理，并主动补偿扰动。数学结构与用二阶滤波器处理速度微分-控制量类似，但ESO参数有理论依据，鲁棒性和响应速度更优。

---

## 四、ESO与数值微分+滤波方法的对比

### 4.1 数值微分+二阶滤波方法

- 速度一阶导+二阶滤波估计加速度，再减去控制量估算扰动：

$$
d_{\text{est,filter}}(s) = G(s) \cdot [sV(s) - U(s)]
$$

其中 $G(s)$ 为二阶滤波器。

### 4.2 区别与联系

- 两者在数学结构上类似，但ESO参数设计有理论依据（极点配置法），能主动估算和补偿扰动，收敛快、滞后小、抗噪声强。
- 普通滤波器仅做信号平滑，无法主动估计和补偿扰动。

> **Note**: 滤波器是被动跟随，ESO是主动估算和补偿，实际工程推荐使用ESO结构。

---

## 五、跟踪微分器（TD）原理与推导

### 5.1 TD的目标与结构

跟踪微分器（TD）用于**平滑跟踪**目标信号 $v_{in}(t)$，输出其**平滑版本** $v_1(t)$ 和**变化率** $v_2(t)$，避免直接跟踪突变信号导致控制系统剧烈反应。

线性TD结构为：

$$
\begin{cases}
\dot{v}_1 = v_2 \\
\dot{v}_2 = R^2 (v_{in} - v_1) - 2R v_2
\end{cases}
$$

### 5.2 TD公式推导与物理意义

目标是让 $v_1$ 平滑地"跟随" $v_{in}$，且 $v_2$ 给出 $v_1$ 的变化率。采用二阶系统思想：

$$
\ddot{v}_1 + 2R \dot{v}_1 + R^2 v_1 = R^2 v_{in}
$$

这是标准的二阶欠阻尼系统，参数 $R$ 控制响应速度和阻尼。  
令 $v_2 = \dot{v}_1$，则状态空间表达为：

$$
\begin{cases}
\dot{v}_1 = v_2 \\
\dot{v}_2 = R^2 (v_{in} - v_1) - 2R v_2
\end{cases}
$$

> **Note**: 线性TD本质上是一个二阶系统，让输出 $v_1$ 平滑跟踪目标 $v_{in}$，输出 $v_2$ 作为导数，参数 $R$ 控制系统响应速度与阻尼。

### 5.3 TD代码实践

```matlab
R = 10;
v1 = 0; v2 = 0;
for i = 1:steps
    vin = ... % 目标信号
    v1 = v1 + dt * v2;
    v2 = v2 + dt * (R^2 * (vin - v1) - 2*R*v2);
end
% v1: 平滑信号, v2: 信号的一阶导数
```

> **Note**: TD能让"跳变"的目标变得顺滑，并提供其变化率，适合控制器做前馈或轨迹跟踪。

---

## 六、个人思考与常见困惑

- **滤波器与ESO的本质区别**：滤波器是信号处理工具，ESO结合系统模型主动估算扰动和状态。
- **ESO和测量值的关系**：ESO估计值与测量值不是完全相同，ESO通过误差修正自身估计，最终逼近真实状态。
- **ESO与TD的关系**：ESO用于系统状态和扰动估计，TD用于平滑目标信号，两者在ADRC框架中分工明确。

---

> **结语**: 自抗扰控制与ESO为现代控制提供了强大的工具，通过理论与实践结合，能更好地应对复杂、未知和扰动丰富的系统。