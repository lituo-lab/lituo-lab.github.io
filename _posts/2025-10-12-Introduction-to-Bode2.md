---
title: 伯德图图频域调参与1/3法则
date: 2025-10-12
categories: [控制理论, 无人机控制]
tags: [Bode图, 相位裕度, 级联控制, 频域分析]
math: true
---

## 一、问题背景与学习困惑

在调试新的无人机系统时，如何让飞机“既快又稳”始终是核心目标。作为一名控制工程师，我在实际设计过程中，遇到了如下典型的困惑：

1. 已知电机/执行器带宽，能否直接应用“1/3法则”设置环路参数以确保稳定性？
2. 如果经验法则（如1/3法则）如此有效，为何仍需频繁分析Bode图的相位裕度？
3. 内外环参数整定能否采用相同的简化方法？两者的设计策略差异究竟在哪里？

这些问题的本质在于如何在工程实践中平衡“经验法则的便捷性”与“频域分析的严谨性”。本文将系统性地梳理这一学习与实践过程。

---

## 二、级联控制系统结构与核心原理

### 2.1 系统结构

无人机姿态控制通常采用“姿态-角速度”双闭环级联结构：

- **内环（角速度环）**：控制器 $C_1(s)$（如PD/PID），被控对象为电机及机体动力学 $P_1(s)$，目标为快速、稳定地响应期望角速度。
- **外环（姿态环）**：控制器 $C_2(s)$（如P控制器），被控对象为内环闭环 $T_1(s)$ 与积分环节 $1/s$，目标为精确跟踪目标姿态。

### 2.2 基础模型分析：$L(s) = k/s$

理解级联控制简化的基础在于分析理想的一阶积分器模型。

#### 2.2.1 系统定义

考虑理想一阶开环系统，其传递函数为：

$$
L(s) = \frac{k}{s}
$$

其中 $k$ 为正实数。假设系统为单位负反馈（$H(s) = 1$），则闭环传递函数 $T(s)$ 为：

$$
T(s) = \frac{L(s)}{1 + L(s)} = \frac{\frac{k}{s}}{1 + \frac{k}{s}} = \frac{k}{s + k}
$$

#### 2.2.2 开环穿越频率 ($\omega_c$) 计算

开环穿越频率 $\omega_c$ 是开环增益 $|L(j\omega)| = 1$（即 $0\text{ dB}$）时的频率：

$$
|L(j\omega)| = \left|\frac{k}{j\omega}\right| = \frac{k}{\omega}
$$

令 $|L(j\omega_c)| = 1$：

$$
\frac{k}{\omega_c} = 1 \implies \omega_c = k
$$

**结论1**：开环穿越频率等于增益 $k$。

#### 2.2.3 闭环带宽 ($\omega_B$) 计算

闭环带宽 $\omega_B$ 是闭环增益 $|T(j\omega)|$ 下降至直流增益 $T(0)$ 的 $1/\sqrt{2}$ 倍（$-3\text{ dB}$）时的频率：

$$
T(0) = \lim_{s \to 0} \frac{k}{s + k} = 1
$$

$$
|T(j\omega)| = \left|\frac{k}{j\omega + k}\right| = \frac{k}{\sqrt{\omega^2 + k^2}}
$$

令 $|T(j\omega_B)| = 1/\sqrt{2}$：

$$
\frac{k}{\sqrt{\omega_B^2 + k^2}} = \frac{1}{\sqrt{2}} \implies \omega_B^2 + k^2 = 2k^2 \implies \omega_B = k
$$

**结论2**：闭环带宽等于增益 $k$。

#### 2.2.4 模型小结

对于理想系统 $L(s) = k/s$，我们得到关键结论：

$$
\text{开环穿越频率 } \omega_c = \text{闭环带宽 } \omega_B = k
$$

该模型在穿越频率处仅产生 $-90^\circ$ 相移，理论上具有最大相位裕度（$90^\circ$），闭环响应极为平坦。**这为外环P控制器 $K_p$ 的简化整定提供了理论基础。**

---

## 三、1/3法则推导与应用：外环的简化设计

经验法则“外环带宽不超过内环带宽的1/3”（$\omega_{\text{outer}} \le \frac{1}{3} \omega_{\text{inner}}$）本质上是环路解耦策略。

### 3.1 1/3法则的理论依据（稳定性推导）

下面验证该法则的合理性。

**1. 模型近似**：
假设内环 $T_{\text{inner}}(s)$ 已设计完成，带宽为 $\omega_{\text{inner}}$，可近似为一阶低通系统：
$$
T_{\text{inner}}(s) \approx \frac{1}{\frac{1}{\omega_{\text{inner}}}s + 1}
$$

外环控制器为 $C_2(s) = K_{p2}$，外环开环传递函数近似为：

$$
L_{\text{outer}}(s) = K_{p2} \cdot T_{\text{inner}}(s) \cdot \frac{1}{s} \approx \frac{K_{p2}}{s \cdot (\frac{1}{\omega_{\text{inner}}}s + 1)}
$$

**2. 带宽设置**：
根据1/3法则，设定外环开环穿越频率 $\omega_c = \frac{\omega_{\text{inner}}}{3}$。

**3. 相位裕度计算**：
计算 $\omega_c$ 处的开环相位：

$$
\angle L_{\text{outer}}(j\omega_c) = \angle\left(\frac{K_{p2}}{j\omega_c}\right) + \angle\left(\frac{1}{\frac{j\omega_c}{\omega_{\text{inner}}} + 1}\right)
$$

$$
\angle L_{\text{outer}}(j\omega_c) = -90^\circ - \arctan\left(\frac{\omega_c}{\omega_{\text{inner}}}\right)
$$

代入 $\omega_c = \omega_{\text{inner}}/3$：

$$
\text{Phase} = -90^\circ - \arctan\left(\frac{1}{3}\right) \approx -90^\circ - 18.4^\circ = -108.4^\circ
$$

相位裕度 $PM$ 为：

$$
PM = 180^\circ + \text{Phase} = 180^\circ - 108.4^\circ = 71.6^\circ
$$

**推论**：$71.6^\circ$ 是一个健康且鲁棒的相位裕度。这证明1/3法则是安全的，为内环动态滞后（引入的 $18.4^\circ$ 相移）预留了充足的稳定裕度。

### 3.2 外环参数简化整定

级联控制设计的关键在于认识到**内环和外环在设计目标与约束上的根本差异**。

基于上述推导，外环（姿态环）设计可大幅简化：

1. **前提**：严格遵守1/3法则，$\omega_{\text{outer}} \le \frac{1}{3}\omega_{\text{inner}}$。
2. **简化**：在此前提下，内环 $T_{\text{inner}}(s)$ 在外环工作频段内近似为 $1$。
3. **等效模型**：外环开环 $L_{\text{outer}}(s) \approx K_{p2} \cdot 1 \cdot \frac{1}{s} = \frac{K_{p2}}{s}$。
4. **应用2.2节结论**：对于 $L(s) = k/s$ 模型，$k = \omega_B$。
5. **整定公式**：在外环中，$k$ 对应 $K_{p2}$，$\omega_B$ 对应 $\omega_{\text{outer}}$，因此：

$$
\omega_{\text{outer}} \approx K_{p2}
$$

结合1/3法则 $\omega_{\text{outer}} \le \frac{\omega_{\text{inner}}}{3}$，得到简化整定公式：

$$
K_{p2} \leq \frac{\omega_{\text{inner}}}{3}
$$

**外环小结**：外环P控制器 $K_{p2}$ 的作用本质上是**设置外环的闭环带宽**。由于其被控对象近似理想积分器，稳定性自然有保障，无需复杂分析即可获得稳定、鲁棒的参数。

---

## 四、内环调参的复杂性与Bode图分析

**核心困惑的解答**：内环（角速度环）的设计**绝不能**像外环一样简化。

### 4.1 被控对象复杂性

内环被控对象 $P_1(s)$（电机/机体）为高阶系统，包含惯性、延迟、电磁常数等动态特性。它**不是**理想积分器，其Bode图在高频处呈现显著相位滞后（远超 $-90^\circ$）。

### 4.2 Bode图裕度分析原理

若忽略 $P_1(s)$ 的相位滞后，强行提高 $K_{p1}$ 以达到目标带宽，将导致穿越频率 $\omega_c$ 处的相位裕度(PM)极低，系统产生剧烈振荡。因此，内环设计**必须**依赖Bode图裕度分析来主动管理相位。

PID各参数对Bode图（开环 $L_1(s)$）及性能的影响如下：

| 参数 | 对Bode图的影响 | 对性能的影响 |
| :--- | :--- | :--- |
| **$K_{p1} \uparrow$** | 幅值曲线**整体上移** | $\omega_c$ 提高（**带宽增加**，响应加快）。$\omega_c$ 右移至相位更低处，**PM减小**（稳定性下降）。 |
| **$K_{d1} \uparrow$** (超前校正) | 在中高频段**抬升相位** | **PM增加**（稳定性提高）。允许使用更高 $K_{p1}$，实现**“又快又稳”**（注意：会放大高频噪声）。 |
| $K_{i1} \uparrow$ (滞后校正) | 提高低频幅值；在中低频**引入相位滞后** | 低频增益提高（**稳态误差减小**）。若滞后作用于 $\omega_c$ 附近，将**减小PM**（稳定性下降）。 |

### 4.3 内环频域整定流程

1. **目标设定**：根据电机带宽 $\omega_{\text{motor}}$，应用1/3法则设定内环**带宽目标** $\omega_{\text{inner}} \leq \frac{1}{3}\omega_{\text{motor}}$，定义 $\omega_c$ 的目标区域。
2. **增益提升 ($K_{p1}$)**：提高 $K_{p1}$，使穿越频率 $\omega_c$ 接近目标带宽 $\omega_{\text{inner}}$。
3. **相位裕度检查**：分析Bode图，此时因 $P_1(s)$ 的滞后，相位裕度(PM)通常不足（例如 $10^\circ \sim 30^\circ$）。
4. **超前校正 ($K_{d1}$)**：加入 $K_{d1}$（微分项），在穿越频率 $\omega_c$ 附近**主动抬升相位**，直至PM达到 $45^\circ \sim 60^\circ$ 的健康范围，确保系统既快又稳。
5. **积分环节 ($K_{i1}$，可选)**：用于消除稳态误差，但需保证其作用频率（转折频率）远低于 $\omega_c$，以避免破坏已调好的相位裕度。

---

## 五、工作流总结与复习要点

### 5.1 调参顺序（从内到外）

1. **内环（角速度环）**：**必须**先用Bode图分析。调整 $K_{p1}$ 设定带宽，调整 $K_{d1}$ 补偿相位。目标是设计带宽为 $\omega_{\text{inner}}$ 且PM达标的**稳定闭环系统 $T_1(s)$**。
2. **外环（姿态环）**：在内环设计完成后，已知 $\omega_{\text{inner}}$。此时**可**用1/3法则简化设计，直接设置 $K_{p2} \approx \frac{\omega_{\text{inner}}}{3}$。

### 5.2 公式与结论复习

- **理想积分器模型**：$L(s) = k/s \implies \omega_B = \omega_c = k$
- **外环P增益整定**（简化公式）：$K_{p2} \leq \frac{\omega_{\text{inner}}}{3}$
- **1/3法则裕度推导**（理论依据）：$PM = 180^\circ - [90^\circ + \arctan(\omega_c/\omega_{\text{inner}})]$ （当 $\omega_c = \omega_{\text{inner}}/3$ 时, $PM \approx 71.6^\circ$）

---

## 六、总结与个人思考

通过系统性梳理，我最初的困惑得到了解答：

- **经验法则（如1/3法则）** 是系统架构的**“战略指导”**。它为带宽分配和系统解耦设定了“上限”，是简化的前提。
- **Bode图裕度分析** 是参数整定的**“战术执行”**。在面对内环复杂被控对象时，它是安全达到带宽“上限”所必需的“工具”。
- **调参策略需区分环路**：
  - **外环（姿态环）**：被控对象近似理想，$K_p$ 整定**本质是带宽设置**。
  - **内环（角速度环）**：被控对象非理想，$K_p/K_d$ 整定**本质是相位裕度管理**。

二者不可混淆。只有先用严谨的频域分析完成内环设计，才能充分发挥1/3法则在外环设计中的便捷性。